# bmstu-dips-lab2
üê¨ –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏. –ú–ì–¢–£ –∏–º. –ë–∞—É–º–∞–Ω–∞.

## Flight Booking System

–°–∏—Å—Ç–µ–º–∞ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–æ–∏—Å–∫–∞ –∏ –ø–æ–∫—É–ø–∫–∏ –±–∏–ª–µ—Ç–æ–≤. –ü—Ä–∏ –ø–æ–∫—É–ø–∫–µ –±–∏–ª–µ—Ç–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –Ω–∞—á–∏—Å–ª—è—é—Ç—Å—è
–±–∞–ª–ª—ã, –∫–æ—Ç–æ—Ä—ã–µ –æ–Ω –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è –æ–ø–ª–∞—Ç—ã.

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ë–∞–∑—ã –î–∞–Ω–Ω—ã—Ö

#### Ticket Service

–°–µ—Ä–≤–∏—Å –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –Ω–∞ –ø–æ—Ä—Ç—É 8070.

```sql
CREATE TABLE ticket
(
    id            SERIAL PRIMARY KEY,
    ticket_uid    uuid UNIQUE NOT NULL,
    username      VARCHAR(80) NOT NULL,
    flight_number VARCHAR(20) NOT NULL,
    price         INT         NOT NULL,
    status        VARCHAR(20) NOT NULL
        CHECK (status IN ('PAID', 'CANCELED'))
);
```

#### Flight Service

–°–µ—Ä–≤–∏—Å –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –Ω–∞ –ø–æ—Ä—Ç—É 8060.

```sql
CREATE TABLE flight
(
    id              SERIAL PRIMARY KEY,
    flight_number   VARCHAR(20)              NOT NULL,
    datetime        TIMESTAMP WITH TIME ZONE NOT NULL,
    from_airport_id INT REFERENCES airport (id),
    to_airport_id   INT REFERENCES airport (id),
    price           INT                      NOT NULL
);

CREATE TABLE airport
(
    id      SERIAL PRIMARY KEY,
    name    VARCHAR(255),
    city    VARCHAR(255),
    country VARCHAR(255)
);
```

```json
{
  "balance": 1500,
  "status": "GOLD",
  "history": [
    {
      "date": "2021-10-08T19:59:19Z",
      "ticketUid": "049161bb-badd-4fa8-9d90-87c9a82b0668",
      "balanceDiff": 1500,
      "operationType": "FILL_IN_BALANCE"
    }
  ]
}
```
#### Bonus Service

–°–µ—Ä–≤–∏—Å –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –Ω–∞ –ø–æ—Ä—Ç—É 8050.

```sql
CREATE TABLE privilege
(
    id       SERIAL PRIMARY KEY,
    username VARCHAR(80) NOT NULL UNIQUE,
    status   VARCHAR(80) NOT NULL DEFAULT 'BRONZE'
        CHECK (status IN ('BRONZE', 'SILVER', 'GOLD')),
    balance  INT
);

CREATE TABLE privilege_history
(
    id             SERIAL PRIMARY KEY,
    privilege_id   INT REFERENCES privilege (id),
    ticket_uid     uuid        NOT NULL,
    datetime       TIMESTAMP   NOT NULL,
    balance_diff   INT         NOT NULL,
    operation_type VARCHAR(20) NOT NULL
        CHECK (operation_type IN ('FILL_IN_BALANCE', 'DEBIT_THE_ACCOUNT'))
);
```

### –û–ø–∏—Å–∞–Ω–∏–µ API

#### –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –ø–µ—Ä–µ–ª–µ—Ç–æ–≤

```http request
GET {{baseUrl}}/api/v1/flights&page={{page}}&size={{size}}
```

#### –ü–æ–ª—É—á–∏—Ç—å –ø–æ–ª–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ

–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –±–∏–ª–µ—Ç–∞—Ö –∏ —Å—Ç–∞—Ç—É—Å–µ –≤ —Å–∏—Å—Ç–µ–º–µ –ø—Ä–∏–≤–∏–ª–µ–≥–∏–∏.

```http request
GET {{baseUrl}}/api/v1/me
X-User-Name: {{username}}
```

#### –ü–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –≤—Å–µ—Ö –±–∏–ª–µ—Ç–∞—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

```http request
GET {{baseUrl}}/api/v1/tickets
X-User-Name: {{username}}
```

#### –ü–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –ø–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É –±–∏–ª–µ—Ç—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

–ü—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –±–∏–ª–µ—Ç –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é.

```http request
GET {{baseUrl}}/api/v1/tickets/{{ticketUid}}
X-User-Name: {{username}}
```

#### –ü–æ–∫—É–ø–∫–∞ –±–∏–ª–µ—Ç–∞

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–∑—ã–≤–∞–µ—Ç –º–µ—Ç–æ–¥ `GET {{baseUrl}}/api/v1/flights` –≤—ã–±–∏—Ä–∞–µ—Ç –Ω—É–∂–Ω—ã–π —Ä–µ–π—Å –∏ –≤ –∑–∞–ø—Ä–æ—Å–µ –Ω–∞ –ø–æ–∫—É–ø–∫—É –ø–µ—Ä–µ–¥–∞–µ—Ç:

* `flightNumber` (–Ω–æ–º–µ—Ä —Ä–µ–π—Å–∞) ‚Äì –±–µ—Ä–µ—Ç—Å—è –∏–∑ –∑–∞–ø—Ä–æ—Å–∞ `/flights`;
* `price` (—Ü–µ–Ω–∞) ‚Äì –±–µ—Ä–µ—Ç—Å—è –∏–∑ –∑–∞–ø—Ä–æ—Å–∞ `/flights`;
* `paidFromBalance` (–æ–ø–ª–∞—Ç–∞ –±–æ–Ω—É—Å–∞–º–∏) ‚Äì —Ñ–ª–∞–≥, —É–∫–∞–∑—ã–≤–∞—é—â–∏–π, —á—Ç–æ –¥–ª—è –æ–ø–ª–∞—Ç—ã –±–∏–ª–µ—Ç–∞ –Ω—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–æ–Ω—É—Å–Ω—ã–π —Å—á–µ—Ç.

–°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ —Ä–µ–π—Å —Å —Ç–∞–∫–∏–º –Ω–æ–º–µ—Ä–æ–º —Å—É—â–µ—Å—Ç–≤—É–µ—Ç. –°—á–∏—Ç–∞–µ–º —á—Ç–æ –Ω–∞ —Ä–µ–π—Å–µ –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–µ—Å—Ç.

–ï—Å–ª–∏ –ø—Ä–∏ –ø–æ–∫—É–ø–∫–µ —É–∫–∞–∑–∞–Ω —Ñ–ª–∞–≥ `"paidFromBalance": true`, —Ç–æ —Å –±–æ–Ω—É—Å–Ω–æ–≥–æ —Å—á—ë—Ç–∞ —Å–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–∞–ª–ª–æ–≤
–≤ –æ—Ç–Ω–æ—à–µ–Ω–∏–∏ 1 –±–∞–ª–ª ‚Äì 1 —Ä—É–±–ª—å.

–¢.–µ. –µ—Å–ª–∏ –Ω–∞ –±–æ–Ω—É—Å–Ω–æ–º —Å—á–µ—Ç–µ –±—ã–ª–æ 500 –±–æ–Ω—É—Å–æ–≤, –±–∏–ª–µ—Ç —Å—Ç–æ–∏—Ç 1500 —Ä—É–±–ª–µ–π –∏ –ø—Ä–∏ –ø–æ–∫—É–ø–∫–µ –±—ã–ª —É–∫–∞–∑–∞–Ω
—Ñ–ª–∞–≥ `"paidFromBalance": true"`, —Ç–æ —Å–æ —Å—á—ë—Ç–∞ —Å–ø–∏—à–µ—Ç—Å—è 500 –±–æ–Ω—É—Å–æ–≤ (–≤ –æ—Ç–≤–µ—Ç–µ –±—É–¥–µ—Ç —É–∫–∞–∑–∞–Ω–æ `"paidByBonuses": 500`), –∞
—Å—Ç–æ–∏–º–æ—Å—Ç—å –±–∏–ª–µ—Ç–∞ –±—É–¥–µ—Ç 1000 —Ä—É–±–ª–µ–π (–≤ –æ—Ç–≤–µ—Ç–µ –±—É–¥–µ—Ç —É–∫–∞–∑–∞–Ω–æ `"paidByMoney": 1000`). –í —Å–µ—Ä–≤–∏—Å–µ Bonus Service –≤
—Ç–∞–±–ª–∏—Ü—É `privilegeHistory` –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∞ –∑–∞–ø–∏—Å—å –æ —Å–ø–∏—Å–∞–Ω–∏–∏ —Å–æ —Å—á—ë—Ç–∞ 500 –±–æ–Ω—É—Å–æ–≤.

–ï—Å–ª–∏ –ø—Ä–∏ –ø–æ–∫—É–ø–∫–µ –±—ã–ª —É–∫–∞–∑–∞–Ω —Ñ–ª–∞–≥ `"paidFromBalance": false`, —Ç–æ –≤ –æ—Ç–≤–µ—Ç–µ –±—É–¥–µ—Ç `"paidByBonuses": 0`, –∞ –Ω–∞ –±–æ–Ω—É—Å–Ω—ã–π —Å—á–µ—Ç
–±—É–¥–µ—Ç –Ω–∞—á–∏—Å–ª–µ–Ω–æ –±–æ–Ω—É—Å–æ–≤ –≤ —Ä–∞–∑–º–µ—Ä–µ 10% –æ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –∑–∞–∫–∞–∑–∞. –¢–∞–∫ –∂–µ –≤ —Ç–∞–±–ª–∏—Ü—É `privilegeHistory` –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∞ –∑–∞–ø–∏—Å—å –æ
–∑–∞—á–∏—Å–ª–µ–Ω–∏–∏ –±–æ–Ω—É—Å–æ–≤.

```http request
POST {{baseUrl}}/api/v1/tickets
Content-Type: application/json
X-User-Name: {{username}}

{
  "flightNumber": "AFL031",
  "price": 1500,
  "paidFromBalance": true
}
```

#### –í–æ–∑–≤—Ä–∞—Ç –±–∏–ª–µ—Ç–∞

–ë–∏–ª–µ—Ç –ø–æ–º–µ—á–∞–µ—Ç—Å—è —Å—Ç–∞—Ç—É—Å–æ–º `CANCELED`, –≤ Bonus Service –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤–æ–∑–≤—Ä–∞—Ç –±–æ–Ω—É—Å–æ–≤ –Ω–∞ —Å—á—ë—Ç
–∏–ª–∏ —Å–ø–∏—Å–∞–Ω–∏–µ —Ä–∞–Ω–µ–µ –Ω–∞—á–∏—Å–ª–µ–Ω–Ω—ã—Ö. –ü—Ä–∏ —Å–ø–∏—Å–∞–Ω–∏–∏ –±–æ–Ω—É—Å–Ω—ã–π —Å—á–µ—Ç –Ω–µ –º–æ–∂–µ—Ç —Å—Ç–∞—Ç—å –º–µ–Ω—å—à–µ 0.

```http request
DELETE {{baseUrl}}/api/v1/tickets/{{ticketUid}}
X-User-Name: {{username}}
```

#### –ü–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ –±–æ–Ω—É—Å–Ω–æ–≥–æ —Å—á–µ—Ç–∞

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –±–æ–Ω—É—Å–Ω–æ–º —Å—á–µ—Ç–µ –∏ –∏—Å—Ç–æ—Ä–∏–∏ –µ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è.

```http request
GET http://localhost:8080/api/v1/privilege
X-User-Name: {{username}}
```

–û–ø–∏—Å–∞–Ω–∏–µ –≤ —Ñ–æ—Ä–º–∞—Ç–µ [OpenAPI](docs/example_openapi.yaml).

### –î–∞–Ω–Ω—ã–µ –¥–ª—è —Ç–µ—Å—Ç–æ–≤

–°–æ–∑–¥–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Ç–µ—Å—Ç–æ–≤:

```yaml
airport:
  ‚Äì id: 1
    name: –®–µ—Ä–µ–º–µ—Ç—å–µ–≤–æ
    city: –ú–æ—Å–∫–≤–∞
    country: –†–æ—Å—Å–∏—è
  - id: 2
    name: –ü—É–ª–∫–æ–≤–æ
    city: –°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥
    coutry: –†–æ—Å—Å–∏—è

flight:
  - id: 1
    flight_number: "AFL031"
    datetime: "2021-10-08 20:00"
    from_airport_id: 2
    to_airport_id: 1
    price: 1500
```
